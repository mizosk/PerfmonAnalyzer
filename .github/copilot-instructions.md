# 重要な指示

## 必須事項

- ドキュメント出力は**日本語で**行う。
- 設計時は設計ガイドラインに従う
- 実装開始時は実装ガイドラインに従う
- テスト実装時はテストガイドラインに従う
- コードレビュー時はレビューガイドラインに従う
- 小規模作業以外は適切なエージェントに`runSubAgent`で作業依頼する。依頼時には必ずIssue番号を添付する
- 小規模作業の場合自分で対応してもよい。その場合実施する作業のガイドラインは必ず確認する

## 設計ガイドライン
設計を行う場合は、`perfmon.architect.agent.md`を参照

## 実装ガイドライン
実装を行う場合は`perfmon.coder.agent.md`を参照

## テストガイドライン
テストを行う場合は`perfmon.coder.agent.md`を参照

## レビューガイドライン
レビューを行う場合は`perfmon.reviewer.agent.md`を参照

## GitHub Issue 管理

- 一連の作業はGitHub Issueを作成して管理する
- Issueが唯一の共有状態であり、設計・進捗・レビュー結果はすべてIssue上で管理する
- Issueのラベルは要求内容から自動判定する（`bug`, `enhancement`, `refactor`, `documentation`, `design`）
- アサインは明示されなければ `@me`（ログイン中のアカウント）に割り当てる
- 作業完了時はIssueをクローズし、完了コメントを残す。**レビューが完了していること**

### Issue 操作コマンド

| 操作 | コマンド |
|------|---------|
| Issue作成 | `gh issue create --title "..." --body "..." --label "..." --assignee "@me"` |
| Issue参照 | `gh issue view <N> --json body -q .body` |
| Issue更新 | 本文をファイルに保存→編集→`gh issue edit <N> -F updated.md` |
| コメント追加 | `gh issue comment <N> --body "..."` |
| Issueクローズ | `gh issue close <N> --comment "完了" --reason completed` |
| ラベル追加 | `gh issue edit <N> --add-label "label"` |

### Issue テンプレート

```markdown
# チケット: <作業名>

## 1. 概要と方針

(概要と方針を1-3文で簡潔に記載)

## 2. 仕様
(この作業による仕様・仕様変更を記載)

## 3. シーケンス図
(mermaidシーケンス図を使用。重要な処理を明示。適宜rectによるフェーズ分け)

## 4. 設計
(設計の詳細を記載。必要に応じてクラス図やフローチャートを追加)

## 5. 考慮事項
（特に注意が必要な点や考慮すべき点、チェックすべき影響範囲などを記載）

## 6. 実装・テスト計画と進捗
（実装項目の細目を以下のタスクの形で記載。実装後にチェックをつけていく）
- [ ] <未完了タスク名>
- [x] <完了タスク名>

## 7. 品質要件チェック
(設計・実装完了後に確認する品質要件を列挙し、確認済みならチェックをつける)

## 8. まとめと改善提案
(作業完了後に振り返りを記載。次回同じ仕事を最初からより高品質に行うための改善提案があれば記載)

## 9. 参考

(個別調査タスクの結果や、ほかの個所に当てはまらない項目などを記載)
```

## ブランチ管理

- `main` ブランチを常にソースオブトゥルースとする
- 作業開始時、`main` から Issue 単位でブランチを作成する
- ブランチ命名規則: `issue/<Issue番号>-<概要の短縮名>`（例: `issue/42-add-csv-export`）
- Issue が完了（レビュー承認済み）したら PR を作成し、`main` へのマージを提案する
- PR 作成時は Issue 番号と紐づける (`Closes #<N>`)

### ブランチ操作コマンド

| 操作 | コマンド |
|------|---------|
| mainから最新取得 | `git fetch origin main` |
| ブランチ作成 | `git checkout -b issue/<N>-<slug> origin/main` |
| PR作成 | `gh pr create --title "..." --body "Closes #<N>" --base main` |

## エージェント連携

エージェント連携の全体ワークフローを知りたい場合は `workflow.md` を参照

| エージェント | 役割 | 呼び出しタイミング |
|------------|------|------------------|
| `perfmon.pm` | タスク全体の調整 | 複数ステップのタスク開始時 |
| `perfmon.architect` | 設計・方針決定 | 新機能・設計変更が必要な場合 |
| `perfmon.coder` | 実装・テスト | 設計完了後の実装作業 |
| `perfmon.reviewer` | コードレビュー | 実装完了後の品質確認 |
| `perfmon.researcher` | 技術調査 | 特定の技術的テーマについて深堀調査する場合 |
| `perfmon.explorer` | コードベース探索 | 影響範囲特定や情報収集が必要な場合 |

**引き継ぎのポイント**
- 各エージェントは作業完了時、次エージェントに必要な情報を明示する
- GitHub Issueを共通の情報源として活用する
